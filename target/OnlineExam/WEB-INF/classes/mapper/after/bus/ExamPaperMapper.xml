<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="xyz.wadewhy.after.bus.mapper.ExamPaperMapper">
  <resultMap id="BaseResultMap" type="xyz.wadewhy.after.bus.domain.ExamPaper">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="examId" jdbcType="INTEGER" property="examid" />
    <result column="studentId" jdbcType="INTEGER" property="studentid" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="totalScore" jdbcType="INTEGER" property="totalscore" />
    <result column="score" jdbcType="INTEGER" property="score" />
    <result column="startExamTime" jdbcType="TIMESTAMP" property="startexamtime" />
    <result column="endExamTime" jdbcType="TIMESTAMP" property="endexamtime" />
    <result column="useTime" jdbcType="INTEGER" property="usetime" />
    <result column="createTime" jdbcType="TIMESTAMP" property="createtime" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, examId, studentId, status, totalScore, score, startExamTime, endExamTime, useTime, 
    createTime
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from bus_exampaper
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from bus_exampaper
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="xyz.wadewhy.after.bus.domain.ExamPaper">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into bus_exampaper (id, examId, studentId, 
      status, totalScore, score, 
      startExamTime, endExamTime, useTime, 
      createTime)
    values (#{id,jdbcType=INTEGER}, #{examid,jdbcType=INTEGER}, #{studentid,jdbcType=INTEGER}, 
      #{status,jdbcType=INTEGER}, #{totalscore,jdbcType=INTEGER}, #{score,jdbcType=INTEGER}, 
      #{startexamtime,jdbcType=TIMESTAMP}, #{endexamtime,jdbcType=TIMESTAMP}, #{usetime,jdbcType=INTEGER}, 
      #{createtime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" useGeneratedKeys="true" keyProperty="id" parameterType="xyz.wadewhy.after.bus.domain.ExamPaper">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into bus_exampaper
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="examid != null">
        examId,
      </if>
      <if test="studentid != null">
        studentId,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="totalscore != null">
        totalScore,
      </if>
      <if test="score != null">
        score,
      </if>
      <if test="startexamtime != null">
        startExamTime,
      </if>
      <if test="endexamtime != null">
        endExamTime,
      </if>
      <if test="usetime != null">
        useTime,
      </if>
      <if test="createtime != null">
        createTime,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="examid != null">
        #{examid,jdbcType=INTEGER},
      </if>
      <if test="studentid != null">
        #{studentid,jdbcType=INTEGER},
      </if>
      <if test="status != null">
        #{status,jdbcType=INTEGER},
      </if>
      <if test="totalscore != null">
        #{totalscore,jdbcType=INTEGER},
      </if>
      <if test="score != null">
        #{score,jdbcType=INTEGER},
      </if>
      <if test="startexamtime != null">
        #{startexamtime,jdbcType=TIMESTAMP},
      </if>
      <if test="endexamtime != null">
        #{endexamtime,jdbcType=TIMESTAMP},
      </if>
      <if test="usetime != null">
        #{usetime,jdbcType=INTEGER},
      </if>
      <if test="createtime != null">
        #{createtime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="xyz.wadewhy.after.bus.domain.ExamPaper">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update bus_exampaper
    <set>
      <if test="examid != null">
        examId = #{examid,jdbcType=INTEGER},
      </if>
      <if test="studentid != null">
        studentId = #{studentid,jdbcType=INTEGER},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="totalscore != null">
        totalScore = #{totalscore,jdbcType=INTEGER},
      </if>
      <if test="score != null">
        score = #{score,jdbcType=INTEGER},
      </if>
      <if test="startexamtime != null">
        startExamTime = #{startexamtime,jdbcType=TIMESTAMP},
      </if>
      <if test="endexamtime != null">
        endExamTime = #{endexamtime,jdbcType=TIMESTAMP},
      </if>
      <if test="usetime != null">
        useTime = #{usetime,jdbcType=INTEGER},
      </if>
      <if test="createtime != null">
        createTime = #{createtime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="xyz.wadewhy.after.bus.domain.ExamPaper">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update bus_exampaper
    set examId = #{examid,jdbcType=INTEGER},
      studentId = #{studentid,jdbcType=INTEGER},
      status = #{status,jdbcType=INTEGER},
      totalScore = #{totalscore,jdbcType=INTEGER},
      score = #{score,jdbcType=INTEGER},
      startExamTime = #{startexamtime,jdbcType=TIMESTAMP},
      endExamTime = #{endexamtime,jdbcType=TIMESTAMP},
      useTime = #{usetime,jdbcType=INTEGER},
      createTime = #{createtime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update>

  <!-- 考生试卷信息搜索查询 -->
  <select id="find" parameterType="Map" resultType="xyz.wadewhy.after.bus.domain.ExamPaper">
    select * from bus_exampaper where examId = #{examid} and studentId = #{studentid}
  </select>

  <!-- 交卷操作 -->
  <update id="submitPaper" parameterType="xyz.wadewhy.after.bus.domain.ExamPaper">
    update bus_exampaper set status = #{status},score = #{score},startExamTime = #{startexamtime},endExamTime = #{endexamtime},useTime = #{usetime} where id = #{id}
  </update>
  <resultMap id="userHistory" type="xyz.wadewhy.after.bus.domain.ExamPaper">
    <id column="ep_id" property="id" />
    <result column="ep_examId" property="examid" />
    <result column="ep_studentId" property="studentid" />
    <result column="ep_status" property="status" />
    <result column="ep_totalScore" property="totalscore" />
    <result column="ep_score" property="score" />
    <result column="ep_startExamTime" property="startexamtime" />
    <result column="ep_endExamTime" property="endexamtime" />
    <result column="ep_useTime" property="usetime" />
    <result column="ep_createTime" property="createtime" />
    <association property="exam" javaType="xyz.wadewhy.after.bus.domain.Exam">
      <id column="e_id" property="id" />
      <result column="e_name" property="name" />
      <result column="e_subjectId" property="subjectid" />
      <result column="e_startTime" property="starttime" />
      <result column="e_endTime" property="endtime" />
      <result column="e_avaliableTime" property="avaliabletime" />
      <result column="e_questionNum" property="questionnum" />
      <result column="e_totalScore" property="totalscore" />
      <result column="e_passScore" property="passscore" />
      <result column="e_singleQuestionNum" property="singlequestionnum" />
      <result column="e_muiltQuestionNum" property="muiltquestionnum" />
      <result column="e_chargeQuestionNum" property="chargequestionnum" />
      <result column="e_wriiterQuestionNum" property="writequestionnum" />
      <result column="e_paperNum" property="papernum" />
      <result column="e_examedNum" property="examedNum" />
      <result column="e_passNum" property="passnum" />
      <result column="e_createTime" property="createtime" />
    </association>
  </resultMap>
  <!-- 用户查询考过的试卷信息 -->
  <select id="findHistory" parameterType="Map" resultMap="userHistory">
    select
    ep.id as ep_id,ep.examId as ep_examId,ep.studentId as ep_studentId,ep.status as ep_status,
    ep.totalScore as ep_totalScore,ep.score as ep_score,ep.startExamTime as ep_startExamTime,
    ep.endExamTime as ep_endExamTime,ep.useTime as ep_useTime,ep.createTime as ep_createTime,
    e.id as e_id,e.name as e_name,e.subjectId as e_subjectId,e.startTime as e_startTime,e.endTime as e_endTime,
    e.avaliableTime as e_avaliableTime,e.questionNum as e_questionNum,e.totalScore as e_totalScore,
    e.passScore as e_passScore,e.singleQuestionNum as e_singleQuestionNum,e.muiltQuestionNum as e_muiltQuestionNum,
    e.chargeQuestionNum as e_chargeQuestionNum,e.paperNum as e_paperNum,e.examedNum as e_examedNum,
    e.passNum as e_passNum,e.createTime as e_createTime
    from bus_exampaper ep,bus_exam e where ep.examId = e.id and ep.studentId = #{studentid} and status = 1
    <if test="name != null">
      and e.name like '%${name}%'
    </if>
    <if test="subjectid != null">
      and e.subjectId = #{subjectid}
    </if>
    order by ep.createTime desc
    <if test="offset != null and pageSize != null">
      limit #{offset},#{pageSize}
    </if>
  </select>


  <!-- 模糊搜索总条数 -->
  <select id="getTotal" parameterType="Map" resultType="Integer">
    select count(*) from bus_exampaper where 1 = 1
    <if test="examid != null">
      and examId = #{examid}
    </if>
    <if test="studentid != null">
      and studentId = #{studentid}
    </if>
    <if test="status != null">
      and status = #{status}
    </if>
  </select>
  <!-- 试卷信息搜索查询 -->
  <select id="findList" parameterType="Map" resultType="xyz.wadewhy.after.bus.domain.ExamPaper">
    select * from bus_exampaper where 1 = 1
    <if test="examid != null">
      and examId = #{examid}
    </if>
    <if test="studentid != null">
      and studentId = #{studentid}
    </if>
    <if test="status != null">
      and status = #{status}
    </if>
    <if test="offset != null and pageSize != null">
      limit #{offset},#{pageSize}
    </if>
  </select>
  <!-- 考试信息统计 -->
  <select id="getExamStats" parameterType="java.lang.Integer" resultType="Map">
    select ep.score as score,ep.totalScore as totalScore,s.name as sname  from bus_exampaper ep,bus_student s where ep.examId = #{value} and ep.studentId = s.id
  </select>
</mapper>